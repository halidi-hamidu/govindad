{% extends '../base.html' %}
{% load static %}
{% block title %} new Job  card  {% endblock %}

{% block content %}

<div class="container-fluid">
  <div class="row">
    <div class="col-md-12">
      <div class="pagetitle">
        <h1>Job Cards</h1>
        <nav>
          <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="#">Dashboard</a></li>
            <li class="breadcrumb-item">Job Cards</li>
            <li class="breadcrumb-item active">new card</li>
          </ol>
        </nav>
      </div><!-- End Page Title -->
    </div>
  </div>
</div>
<div class="container-fluid">
  <div class="row">
    <!-- pending card -->
    <div class="col-xxl-4 col-md-6">
      <div class="card info-card sales-card">
        <div class="card-body">
          <h5 class="card-title">Pending cards <span></span></h5>

          <div class="d-flex align-items-center">
            <div class="card-icon rounded-circle d-flex align-items-center justify-content-center">
              <i class="bi bi-card-list" style="font-size: 50px;"></i>
            </div>
            <div class="ps-3">
              <h6>145</h6>
              <!-- <span class="text-success small pt-1 fw-bold">12%</span> <span class="text-muted small pt-2 ps-1">increase</span> -->

            </div>
          </div>
        </div>

      </div>
    </div>
    <!-- Approved Cards -->
    <div class="col-xxl-4 col-md-6">
      <div class="card info-card revenue-card">

       

        <div class="card-body">
          <h5 class="card-title">Approved cards <span></span></h5>

          <div class="d-flex align-items-center">
            <div class="card-icon rounded-circle d-flex align-items-center justify-content-center">
              <i class="bi bi-card-list" style="font-size: 50px;"></i>
            </div>
            <div class="ps-3">
              <h6>145</h6>
              <!-- <span class="text-success small pt-1 fw-bold">12%</span> <span class="text-muted small pt-2 ps-1">increase</span> -->

            </div>
          </div>
        </div>

      </div>
    </div>

    <!-- canceld Cards -->
    <div class="col-xxl-4 col-xl-12">

      <div class="card info-card customers-card">

        <div class="card-body">
          <h5 class="card-title">Canceld cards <span></span></h5>

          <div class="d-flex align-items-center">
            <div class="card-icon rounded-circle d-flex align-items-center justify-content-center">
              <i class="bi bi-card-list" style="font-size: 50px;"></i>
            </div>
            <div class="ps-3">
              <h6>145</h6>
              <!-- <span class="text-success small pt-1 fw-bold">12%</span> <span class="text-muted small pt-2 ps-1">increase</span> -->

            </div>
          </div>
        </div>
      </div>

    </div>

  </div>
</div>
<div class="container-fluid">
    <div class="row">
        <div class="col-md-12">
           
          
              <section class="section">
                <div class="row">
                  <div class="col-lg-12">
          
                    <div class="card">
                      <div class="card-body">
                       <div class="buttons_title-section" style="display: flex;justify-content: space-between;">
                        <div class="title">
                          <h5 class="card-title">Job Cards</h5>
                        </div>
                        <div class="button_section p-3">
                          <button class=" btn btn-outline-primary"  type="button"  data-bs-toggle="modal" data-bs-target="#staticBackdrop"><i class="bi bi-plus-lg"></i> new Card</button>
                        </div>
                       </div>
                  
          
                        <!-- Table with stripped rows -->
                        <table class="table datatable" id="example">
                          <thead>
                            <tr>
                              <th scope="col">#</th>
                              <th scope="col">Name</th>
                              <th scope="col">Position</th>
                              <th scope="col">Age</th>
                              <th scope="col">Start Date</th>
                            </tr>
                          </thead>
                          <tbody>
                            <tr>
                              <th scope="row">1</th>
                              <td>Brandon Jacob</td>
                              <td>Designer</td>
                              <td>28</td>
                              <td>2016-05-25</td>
                            </tr>
                            <tr>
                              <th scope="row">2</th>
                              <td>Bridie Kessler</td>
                              <td>Developer</td>
                              <td>35</td>
                              <td>2014-12-05</td>
                            </tr>
                            <tr>
                              <th scope="row">3</th>
                              <td>Ashleigh Langosh</td>
                              <td>Finance</td>
                              <td>45</td>
                              <td>2011-08-12</td>
                            </tr>
                            <tr>
                              <th scope="row">4</th>
                              <td>Angus Grady</td>
                              <td>HR</td>
                              <td>34</td>
                              <td>2012-06-11</td>
                            </tr>
                            <tr>
                              <th scope="row">5</th>
                              <td>Raheem Lehner</td>
                              <td>Dynamic Division Officer</td>
                              <td>47</td>
                              <td>2011-04-19</td>
                            </tr>
                          </tbody>
                        </table>
                        <!-- End Table with stripped rows -->
          
                      </div>
                    </div>
          
                  </div>
                </div>
              </section>
        </div>
    </div>
    
</div>


<!-- Button trigger modal -->


<!-- Modal -->
<div class="modal fade" id="staticBackdrop" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable">
    <div class="modal-content">
      <div class="modal-header">
        <h1 class="modal-title fs-5" id="staticBackdropLabel">  Job Card Form </h1>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
       
    
    
        <div style="min-height: 100px;">
        
            <div class="card card-body" style="width: 100%">
              <form class="row g-3">
                <div class="col-12">
                  <label for="inputNanme4" class="form-label">Customer Name</label>
                  <input type="text" class="form-control" id="inputNanme4">
                </div>
                <div class="col-12">
                  <label for="inputNanme4" class="form-label">Job Description</label>
                  <textarea type="text" class="form-control" id="jobDescriptions" name="jobDescriptions"> </textarea>
                </div>
                <div class="col-12">
                  <label for="finishedSize" class="form-label">Finished Size</label>
                  <input type="text" class="form-control" id="finishedSize" name="finishedSize">
                </div>
                <div class="col-12">
                  <label for="numberOfPage" class="form-label">No. Pages</label>
                  <input type="number" class="form-control" id="numberOfPage" name="numberOfPage">
                </div>
                <div class="col-12">
                  <label for="numberOfColours" class="form-label">No. Colours</label>
                  <input type="number" class="form-control" id="numberOfColours" name="numberOfColours">
                </div>

                <div class="col-md-12">
                  <label for="numberOfColours" class="form-label">Printing</label>
                  <div class="form-floating">
                    
                    <select class="form-select" id="printing">
                      <option value="....">...</option>
                      <option value="Both side">Both side</option>
                      <option value="One side">One side</option>
                      <option value="Coating or Lamination">Coating / Lamination</option>
                    </select>
                  </div>
                </div>

                <div class="col-12">
                  <label for="numberOfColours" class="form-label">Finishing</label>
                  <input type="text" class="form-control" id="finishing" name="finishing">
                </div>


               
                 
                  <button class="btn btn-outline-primary w-100" type="button" data-bs-toggle="collapse" data-bs-target="#collapseExample" aria-expanded="false" aria-controls="collapseExample">
                    Designing
                  </button>
               
                <div class="collapse" id="collapseExample">
                 
                    <div class="col-12">
                      <label for="numberOfColours" class="form-label">File Name</label>
                      <input type="text" class="form-control" id="fileName" name="fileName">
                    </div>
                    <div class="col-12">
                      <label for="numberOfColours" class="form-label">Folder Name</label>
                      <input type="text" class="form-control" id="folderName" name="folderName">
                    </div>
                    <div class="col-12">
                      <label for="numberOfColours" class="form-label">Job Size</label>
                      <input type="text" class="form-control" id="jobSize" name="jobSize">
                    </div>
                 
                </div>

                <button class="btn btn-outline-primary w-100" type="button" data-bs-toggle="collapse" data-bs-target="#papersection" aria-expanded="false" aria-controls="collapseExample">
                  Paper
                </button>


                <div class="collapse" id="papersection">
                 
                  <div class="col-12">
                    <table class="table">
                      <thead>
                        <tr>
                         
                          <th scope="col">Size</th>
                          <th scope="col">Gsm</th>
                          <th scope="col">Details</th>
                          <th></th>
                        </tr>
                      </thead>
                      <tbody class="table-group-divider">
                        
                        <div class="row" id="form_wrapper">
                          <tr>
                       
                            <td>
                              <input type="text" class="form-control" id="paperSize" name="paperSize">
                            </td>
                            <td>
                              <input type="text" class="form-control" id="gsm" name="gsm">
                            </td>
                            <td>
                              <input type="text" class="form-control" id="details" name="details">
                            </td>
                            <td>
                              
                            </td>
                          </tr>
                        </div>
                        
                      
                      </tbody>
                    </table>
                    <div class="controls" style="display: flex;">
                      <button type="button" class="add" name="add_field" value="add_field" id="add_field"><i class="fa fa-plus"></i>+</button>
                      <button class="remove" onclick="remove()"><i class="fa fa-minus"></i>-</button>
                    </div>
                  </div>
                  
               
              </div>

                
                
                <div class="text-left">
                  <button type="submit" class="btn btn-outline-success">Submit</button>
                  <button type="reset" class="btn btn-outline-secondary">Reset</button>
                </div>
              </form>
            </div>
          </div>
        </div>
 
      <div class="modal-footer">
        <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Close</button>
        <button type="button" class="btn btn-outline-primary">Understood</button>
      </div>
    </div>
  </div>
</div>


<script type="text/javascript">
  $(document).ready( function (){
    var x = 0;
    let counter = 0;
   
    $('#add_field').click(function (e){
      e.preventDefault();
      counter ++,
      console.log('Button add field clicked ');
      appendRow();
      x++;
    });
    $('#sell_product').click(function (e){
      e.preventDefault();
      get_product = document.getElementsByTagName('form')
      console.log(get_product)
      
      
    });
  
    $('#form_wrapper').on('click', '.deleteBtn', function(e){
      e.preventDefault();
      var id = e.currentTarget.id;
      $('div[id='+id+']').remove();
      x--;
  
      if (x === 0){
        console.log("==field deleted======");
      }
  
    });
    $('#sell_product').click(function(e){
      e.preventDefault();
      console.log('Save button clicked');
      var formData = $('#myForm').serializeObject();
      var obj;
  
      var customer_full_name_array = [];
      var product_name_array = [];
      var number_of_product_nedeed_array = [];
      var advance_paid = [];
      var shop_name_array = [];
      var date_for_issues_invoice_array = [];
  
      var fData = []
      //var button_status = document.getElementById('#sell_product').values;
  
      console.log('Data is ',formData )
      
  
      if (Array.isArray(formData.product_name)){
        console.log('There are More than One Product Added', formData.product_name.length);
        fData.push(formData);
        //window.location.reload();
        console.log("the form Data is", fData)
        obj = {};
        //var formData =[];
        //for (var i =0; i< formData.product_name.length; i++){
        //  obj.customer_full_name = formData.customer_full_name[i];
        //  obj.product_name = formData.product_name[i];
        //  obj.number_of_product_nedeed = formData.number_of_product_nedeed[i];
        //  obj.shop_name = formData.shop_name[i];
        //  obj.date_for_issues_invoice = formData.date_for_issues_invoice[i];
  //
  //
        //  customer_full_name_array.push(formData.customer_full_name[i]);
        //  product_name_array.push(formData.product_name[i]);
        //  number_of_product_nedeed_array.push(formData.number_of_product_nedeed[i]);
        //  shop_name_array.push(formData.shop_name[i]);
        //  date_for_issues_invoice_array.push(formData.date_for_issues_invoice[i]);
    
        //  console.log("The products ......... are ", obj)
  
        //};
  
        //  console.log("The product are ", product_name_array);
        //  console.log("The customers  are ", customer_full_name_array);
        //  console.log("The prodiuct nedded are ", number_of_product_nedeed_array);
        //  console.log("The shop are ", shop_name_array);
        //  console.log("The Date for Invoices are ", date_for_issues_invoice_array);
      
        
        $.ajax({
          type: 'POST',
          
          headers: {'X-CSRFToken': '{{ csrf_token }}'},
          //dataType : "json",
          data: {
  
                   'formData':JSON.stringify(fData),
                   
                  //'customer_full_name':customer_full_name_array, 
                  //'product_name': product_name_array,
                  //'number_of_product_nedeed':number_of_product_nedeed_array,
                  //'shop_name':shop_name_array,
                  //'date_for_issues_invoice':date_for_issues_invoice_array,
                  //'button_status':button_status, 
  
          },
       
            success : function(data){
            x = data.status; 
            $('#myForm')[0].reset();
            location.reload(true);
            //
            alert("data sent")
            var m = "Products Succesfully Sold";
            swal({
              position: 'top-right',
              icon: 'success',
              title:"success",
              text:m,
              showConfirmButton: true,
            });
            
            location.reload(true);
        }
  
        
        
        
        
        });
        //window.location.reload(true);
        
       
      }else{
        console.log("There is One product added")
        obj = {}
        obj.customer_full_name = formData.customer_full_name;
        obj.product_name = formData.product_name;
        obj.number_of_product_nedeed = formData.number_of_product_nedeed;
        obj.advance_paid = formData.advance_paid;
        obj.shop_name = formData.shop_name;
        obj.date_for_issues_invoice = formData.date_for_issues_invoice;
        //obj.button_status = formData.sell_product;
  
        customer_full_name_array.push(formData.customer_full_name);
        product_name_array.push(formData.product_name);
        number_of_product_nedeed_array.push(formData.number_of_product_nedeed);
        advance_paid.push(formData.advance_paid);
        shop_name_array.push(formData.shop_name);
        date_for_issues_invoice_array.push(formData.date_for_issues_invoice);
  
        console.log("Customer name ",customer_full_name_array );
        console.log("Product name ",product_name_array );
        console.log("Number of Product nedeed ",number_of_product_nedeed_array );
        console.log("Advance Paid ",advance_paid );
        console.log("Shop name ",shop_name_array );
        console.log("Date for Issues the Invoices ",date_for_issues_invoice_array );
        //console.log("Date for Issues the Invoices ",shop_name_array );
  
        $.ajax({
          type: 'POST',
         
          headers: {'X-CSRFToken': '{{ csrf_token }}'},
          data: {
                  'customer_full_name':customer_full_name_array, 
                  'product_name': product_name_array,
                  'number_of_product_nedeed':number_of_product_nedeed_array,
                  'advance_paid':advance_paid,
                  'shop_name':shop_name_array,
                  'date_for_issues_invoice':date_for_issues_invoice_array,
                  //'button_status':button_status, 
  
          },
          success : function(data){
            x = data.status;
            $('#myForm')[0].reset();
            location.reload(true)
            var m = "Product Succesfully Sold";
            swal({
              position: 'top-right',
              icon: 'success',
              title:"success",
              text:m,
              showConfirmButton: true,
            });
            
          
        }
        });
      }
  
  
    })
    function appendRow(){
    
      $('#form_wrapper').append(

      '<tr id="form_wrapper">'+
                       
      '<td>'+
        '<input type="text" class="form-control" id="paperSize" name="paperSize">' +
      '</td>' +
      '<td>' +
        '<input type="text" class="form-control" id="gsm" name="gsm">' +
      '</td>' +
      '<td>' +
        '<input type="text" class="form-control" id="details" name="details">' +
      '</td>' +
      '<td>' +
        
      '</td>' +
      '</tr>'

      
       
      // '<div id ="'+x+'" ' +
      //   '<div id ="'+x+'"  class="col-md-12" >' +
      //     '{% if get_all_products %}' +
      //    '<div id ="'+x+'"  class="form-group" id="formfield">' +
      //       '<label id ="'+x+'"  for="select2SinglePlaceholder" class="d-block"> Select product</label>' +
      //       '<select id ="'+x+'"  class="select2-single-placeholder-product form-control" name="product_name" id="product_name" style="width: 100%;padding:10px">' +
      //         '<option id ="'+x+'"  value="not selected">Select</option>' +
      //         '{% for products in get_all_products %}' +
      //         '<option id ="'+x+'"  value="{{ products.id }}">{{products}}</option>' +
      //         '{% endfor %}' +
      //       '</select id ="'+x+'" >' +
           
      //     '</div id ="'+x+'" >' +
      //     '{% endif %}' +
      
          
          
      //  ' </div id ="'+x+'" >' +
      
    
      //   '<div id ="'+x+'"  class="col-md-12 my-3">'+
      //   ' <div id ="'+x+'"  class="form-group">'+
      //      '<label id ="'+x+'"  for="quantity" >Number of products nedeed</label>'+
      //      '<input id ="'+x+'"  type="number" name="number_of_product_nedeed" class="form-control">'+
      //    '</div id ="'+x+'" >'+
         
      //    '</div id ="'+x+'" >' +

      //   '<div id ="'+x+'"  class="col-md-12 my-3">'+
      //   ' <div id ="'+x+'"  class="form-group">'+
      //      '<label id ="'+x+'"  for="quantity" >Amount paid As Advance</label>'+
      //      '<input id ="'+x+'"  type="number" name="advance_paid" class="form-control">'+
      //    '</div id ="'+x+'" >'+
      //    '<button class="btn btn-outline-danger deleteBtn" id ="'+x+'" > Delete Field</button>' +
      //    '</div id ="'+x+'" >' +
         
      //   '</div id ="'+x+'" >' 
        
       
  
      );
      //$("#product_name"counter).select2();
         
         
    }
  
    $.fn.serializeObject = function(asString){
      var o = {}
      var a = this.serializeArray();
      $.each(a, function(){
        if ($('#' + this.name).hasClass('date')){
          this.value = new Date (this.value).setHours(12);
        }
  
        if (o[this.name] !== undefined ){
          if (!o[this.name].push){
            o[this.name] = [o[this.name]];
  
           }
  
           o[this.name].push(this.value ||  '');
        }else{
          o[this.name] = this.value || '';
        }
      });
      if (asString){
        return JSON.stringify(o);
      }
      return o;
    };
  });
  
  
  </script>



{% endblock %}